<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8">
    <title>Desenhar - Sala {{ room }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>

<body class="page-draw">
    <img src="{{ url_for('static', filename='imagem/logo.png') }}" class="logo-home" alt="logo">
    <div class="draw-container">
        <div class="draw-header">
            <h2 class="draw-title">Desenhe!</h2>
            <div class="draw-timer">Tempo: <span id="timer">{{ tempo }}</span>s</div>
        </div>

        <div class="word-box">
            <strong>Palavra:</strong> <span id="palavra">{{ palavra }}</span>
        </div>

        <canvas id="canvas" width="800" height="450"></canvas>

        <div class="draw-actions">
            <button class="btn" id="clearBtn">Limpar Tela</button>
            <a class="home-link" href="{{ url_for('tempo') }}">&lt; VOLTAR</a>
            <a class="home-link" href="{{ url_for('homepage') }}">SAIR</a>
        </div>
    </div>

    <!-- dependências / scripts -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>

    <!-- Dados serializados pelo Jinja em JSON (evita problemas de escape) -->
    <script id="game-data" type="application/json">
        {
            {
                {
                    "room": room,
                    "palavra": palavra,
                    "tempo": tempo
                } | tojson
            }
        }
    </script>

    <!-- Inicialização segura: pega o JSON e cria window.GAME -->
    <script>
        (function() {
            try {
                const raw = document.getElementById('game-data').textContent;
                const data = JSON.parse(raw);

                // garante tipos esperados: tempo como número
                if (typeof data.tempo === 'string' && data.tempo.trim() !== '') {
                    const n = Number(data.tempo);
                    if (!Number.isNaN(n)) data.tempo = n;
                }

                window.GAME = data;

                // atualiza DOM visível caso queira (opcional/seguro)
                const timerEl = document.getElementById('timer');
                if (timerEl && (typeof data.tempo === 'number' || typeof data.tempo === 'string')) {
                    timerEl.textContent = data.tempo;
                }
                const palavraEl = document.getElementById('palavra');
                if (palavraEl && data.palavra != null) palavraEl.textContent = data.palavra;

                // chama initDrawing — certifique-se que script.js define essa função
                if (typeof initDrawing === 'function') {
                    initDrawing();
                } else {
                    console.warn('initDrawing() não encontrada. Verifique se script.js carregou corretamente.');
                }
            } catch (err) {
                console.error('Erro ao inicializar window.GAME:', err);
            }
        })();
    </script>
</body>

</html>